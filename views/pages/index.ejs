<!DOCTYPE html>

<html lang="en">
<head>
   <%include ../partials/head %>
   <title>Inicio</title>
   <style>
        table, th, td {
            border: 1px solid black;
        }
        .green {
            background-color: green;
            color: #ffffff;
        }
        .red {
            background-color: red;
            color: #ffffff;
        }

   </style>
</head>

<body>
   <div id="wrapper">
      <!-- Sidebar -->


      <div id="sidebar-wrapper">
         <%include ../partials/sidebar-wrapper %>
      </div>
      <!-- Page Content -->


        <div id="page-content-wrapper" style="height: 100vh">
        <%include ../partials/navbar %>

        <div class="row">
            <div class="col-lg-12 col-sm-12">
                <h2>Inicio</h2> <!-- TODO: Hay que cambiar este titulo a otro lado o de plano quitarlo -->
                <!-- TODO: Hay que hay que revisar si la tablet esta connectada o no para poner el status real una vez se abre la pagina -->
                <div class="widget widget-stats">
                <div class="content">
                    <table border="1" class="table table-bordered" id='eventos'>
                            <thead>
                                <tr>
                                    <th>Conexion</th>
                                    <th>Estado</th>
                                    <th>Maquina</th>
                                    <th>Producto</th>
                                    <th>Disponibilidad</th>
                                    <th>Rendimiento</th>
                                    <th>Calidad</th>
                                    <th>OEE</th>
                                </tr>
                            </thead>
                            
                
                            <tr class="quote">
                                <td id ="conexion">
                                </td>
                                <td id="estado" class="">
                                </td>
                                <td id="maquina">
                                </td>
                                <td>
                                </td>
                                <td>
                                </td>
                                <td>
                                </td>
                                <td>
                                </td>
                                <td>
                                    </td>
                            </tr>
                            
                            </table>
                            
                
                            <p class="alert alert-warning">No eventos registrados en el turno actual</p>
                        </div>
                </div>
                <button onclick="myFunction()">Activo</button>
                <button onclick="myFunction2()">Operador</button>
                <button onclick="hoy()">hora actual</button>
                <button onclick="zona()">hora con timezone del cliente</button>
            </div>
        </div>
        </div>
      <!-- /#page-content-wrapper -->
   </div>
   <!-- /#wrapper -->
   <script src="http://code.jquery.com/jquery-1.10.1.min.js">
   </script> 
   <script src="/socket.io/socket.io.js">
   </script> 
   <script>
        
        // TODO: Esto tiene que estar con la url del servidor una vez arriba 
        //var socket = io.connect('http://ec2-18-221-199-24.us-east-2.compute.amazonaws.com:3000');
        var socket = io.connect('localhost:3000');

        socket.on('estado-actual', function(message) {
            
            console.log(message);
            var mensaje = JSON.parse(message);
            $('#estado').html(mensaje.nombre);
            

            if (mensaje.razones_id == '1'){
                console.log('verde');
                $('#estado').addClass('green');
                $('#estado').removeClass('red');
            } else {
                console.log('rojo');
                $('#estado').addClass('red');
                $('#estado').removeClass('green');
            }
        })
        
        socket.on('message', function(message) {
            console.log('el server esta vivo');
        })
        
        function myFunction() {
            var obj = { "razones_id":"1"};
            var myJSON = JSON.stringify(obj);
            console.log("mande un evento");
            socket.emit('evento', myJSON)

        }

        function myFunction2() {
            var obj = { "razones_id":"2"};
            var myJSON = JSON.stringify(obj);
            console.log("mande un evento");
            socket.emit('evento', myJSON)
            
        }

        function hoy() {
            socket.emit('tiempo', 'normal')
        }

        function zona() {
            socket.emit('tiempo', 'zona')
        }

        socket.on('tiempo', function(message) {
            console.log('se recibio un valor: ' + message);
        })

   </script> 
   <%include ../partials/js %>
</body>
</html>